{% load feincms_tags ticker jsonify markdown_deux_tags %}
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="NOFOLLOW, NOINDEX" />

    <title>YouthHostel.ch Info Screen</title>

    <script>
    /* eslint-disable */
      var _rollbarConfig = {
        accessToken: "95f4132658f44c3780e127e0ac5eb530",
        captureUncaught: true,
        payload: {
          environment: {% if debug %}"development"{% else %}"production"{% endif %}
        }
      };
      // Rollbar Snippet
      !function(r){function o(e){if(t[e])return t[e].exports;var n=t[e]={exports:{},id:e,loaded:!1};return r[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}var t={};return o.m=r,o.c=t,o.p="",o(0)}([function(r,o,t){"use strict";var e=t(1).Rollbar,n=t(2);_rollbarConfig.rollbarJsUrl=_rollbarConfig.rollbarJsUrl||"https://d37gvrvc0wt4s1.cloudfront.net/js/v1.7/rollbar.min.js";var a=e.init(window,_rollbarConfig),i=n(a,_rollbarConfig);a.loadFull(window,document,!_rollbarConfig.async,_rollbarConfig,i)},function(r,o){"use strict";function t(){var r=window.console;r&&"function"==typeof r.log&&r.log.apply(r,arguments)}function e(r,o){return o=o||t,function(){try{return r.apply(this,arguments)}catch(t){o("Rollbar internal error:",t)}}}function n(r,o,t){window._rollbarWrappedError&&(t[4]||(t[4]=window._rollbarWrappedError),t[5]||(t[5]=window._rollbarWrappedError._rollbarContext),window._rollbarWrappedError=null),r.uncaughtError.apply(r,t),o&&o.apply(window,t)}function a(r){this.shimId=++p,this.notifier=null,this.parentShim=r,this.logger=t,this._rollbarOldOnError=null}function i(r){var o=a;return e(function(){if(this.notifier)return this.notifier[r].apply(this.notifier,arguments);var t=this,e="scope"===r;e&&(t=new o(this));var n=Array.prototype.slice.call(arguments,0),a={shim:t,method:r,args:n,ts:new Date};return window._rollbarShimQueue.push(a),e?t:void 0})}function l(r,o){if(o.hasOwnProperty&&o.hasOwnProperty("addEventListener")){var t=o.addEventListener;o.addEventListener=function(o,e,n){t.call(this,o,r.wrap(e),n)};var e=o.removeEventListener;o.removeEventListener=function(r,o,t){e.call(this,r,o&&o._wrapped?o._wrapped:o,t)}}}var p=0;a.init=function(r,o){var t=o.globalAlias||"Rollbar";if("object"==typeof r[t])return r[t];r._rollbarShimQueue=[],r._rollbarWrappedError=null,o=o||{};var i=new a;return e(function(){if(i.configure(o),o.captureUncaught){i._rollbarOldOnError=r.onerror,r.onerror=function(){var r=Array.prototype.slice.call(arguments,0);n(i,i._rollbarOldOnError,r)};var e,a,p="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(e=0;e<p.length;++e)a=p[e],r[a]&&r[a].prototype&&l(i,r[a].prototype)}return r[t]=i,i},i.logger)()},a.prototype.loadFull=function(r,o,t,n,a){var i=function(){var o;if(void 0===r._rollbarPayloadQueue){var t,e,n,i;for(o=new Error("rollbar.js did not load");t=r._rollbarShimQueue.shift();)for(n=t.args,i=0;i<n.length;++i)if(e=n[i],"function"==typeof e){e(o);break}}"function"==typeof a&&a(o)},l=!1,p=o.createElement("script"),u=o.getElementsByTagName("script")[0],s=u.parentNode;p.src=n.rollbarJsUrl,p.async=!t,p.onload=p.onreadystatechange=e(function(){if(!(l||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)){p.onload=p.onreadystatechange=null;try{s.removeChild(p)}catch(r){}l=!0,i()}},this.logger),s.insertBefore(p,u)},a.prototype.wrap=function(r,o){try{var t;if(t="function"==typeof o?o:function(){return o||{}},"function"!=typeof r)return r;if(r._isWrap)return r;if(!r._wrapped){r._wrapped=function(){try{return r.apply(this,arguments)}catch(o){throw o._rollbarContext=t()||{},o._rollbarContext._wrappedSource=r.toString(),window._rollbarWrappedError=o,o}},r._wrapped._isWrap=!0;for(var e in r)r.hasOwnProperty(e)&&(r._wrapped[e]=r[e])}return r._wrapped}catch(n){return r}};for(var u="log,debug,info,warn,warning,error,critical,global,configure,scope,uncaughtError".split(","),s=0;s<u.length;++s)a.prototype[u[s]]=i(u[s]);r.exports={Rollbar:a,_rollbarWindowOnError:n}},function(r,o){"use strict";r.exports=function(r,o){return function(t){if(!t&&!window._rollbarInitialized){var e=window.RollbarNotifier,n=o||{},a=n.globalAlias||"Rollbar",i=window.Rollbar.init(n,r);i._processShimQueue(window._rollbarShimQueue||[]),window[a]=i,window._rollbarInitialized=!0,e.processPayloads()}}}}]);
      // End Rollbar Snippet
      /* eslint-enable */
</script>


    <link rel="stylesheet" href="{{ STATIC_URL }}screen/css/lib/boilerplate.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}screen/fonts/akkurat.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}screen/fonts/bodoni.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}screen/css/dist/global.css" />

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

    <script type="text/javascript" src="{{ STATIC_URL }}screen/lib/coolclock/coolclock.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}screen/lib/coolclock/moreskins.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}screen/lib/skycons/skycons.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}screen/js/dist/main.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}screen/js/global.js"></script>
</head>
<body>
  <div id="container" class="flex flex-column cover-parent">
    <header class="flex space-around head">
        <div id="weather">
          <canvas id="weather-icon"></canvas>
          <span data-hook='weather-temperature'>??</span>
        </div>

        <div id="announcements">
            <div>Das ganze Jugi Team wünscht Ihnen einen guten Appetit!</div>
        </div>

        <canvas id="clock" class="CoolClock:chunkySwiss:30"></canvas>
    </header>

    <div data-hook='panel-hook' class="flex-grow relative content"></div>

    <div class="progress" data-hook="progress"></div>
  </div>

    <script type="text/template" id="text-template">
      <div>
        <%= textWrapped %>
      </div>
    </script>

    <script type="text/template" id="media-meta">
      <div class="image-meta">
        <div class="caption"><span><b><%- caption %></b></span></div>
        <div class="description"><span><%- description %></span></div>
        <div class="copyright"><span><%- copyright %></span></div>
      </div>
    </script>

    <script type="text/template" id="media-template-cover">
      <%= meta %>
    </script>

    <script type="text/template" id="media-template-contain">
      <div class="cover-parent flex flex-column">
        <div class="flex-grow bg-contain" data-hook='bg-image'></div>

        <%= meta %>
      </div>
    </script>

    <script type="text/template" id="embedly-template">
      <%= response.html %>
    </script>

    <script type="text/template" id="embedly-template-link">
      <iframe src="<%= response.url %>">
    </script>

    <script type="text/template" id="news-template">
      <div class="news-item">
        <div><span><b><%= title %></b></span></div>
        <div class="news-body"><%= body %></div>
        <div><span><small><%= source %> - <%= timestamp %></small></span></div>
      </div>
    </script>

    <script type="text/template" id="weather-template">
      <iframe class="weather-embed"
        type="text/html"
        src="http://forecast.io/embed/#lat=<%= lat %>&lon=<%= lon %>&font=Arial&units=ca&text-color=white&color=#5d8dcb&hide-header=true">
      </iframe>
    </script>

    <script>
        window.ScreenData = {
            location: "{{ feincms_page.location }}",
            main: [
                {% for content in feincms_page.content.main %}
                {
                    type: '{{ content.Meta.verbose_name|lower }}',
                    ordering: {{ content.ordering }},
                    priority: {{ content.priority }},
                    morning: {{ content.morning|lower }},
                    noon: {{ content.noon|lower }},
                    afternoon: {{ content.afternoon|lower }},
                    evening: {{ content.evening|lower }},
                    night: {{ content.night|lower }},

                    data: {
                      {% if content.Meta.verbose_name|lower == 'text' %}
                          text: '{{ content.text|markdown|escapejs }}',
                          size: '{{ content.size }}',

                      {% elif content.Meta.verbose_name|lower == 'mediendatei' %}

                          type: '{{ content.mediafile.type }}',
                          url: '{{ content.mediafile.get_absolute_url }}',
                          cover: {{ content.mediafile.cover|lower }},
                          caption: '{{ content.mediafile.translation.caption }}',
                          description: '{{ content.mediafile.translation.description }}',
                          copyright: '{{ content.mediafile.copyright }}'


                      {% elif content.Meta.verbose_name|lower == 'simple image gallery' %}
                          mediafiles: [
                              {% for m in content.category.mediafile_set.all %}
                              {
                                  url: '{{ m.get_absolute_url }}',
                                  type: '{{ m.type }}',
                                  cover: {{ m.cover|lower }},
                                  caption: '{{ m.translation.caption }}',
                                  copyright: '{{ m.copyright }}',
                                  description: '{{ m.translation.description }}'
                              }{% if not forloop.last %},{% endif %}
                              {% endfor %}
                          ],

                      {% elif content.Meta.verbose_name|lower == 'externer inhalt' %}
                          type: '{{ content.type }}',
                          url: '{{ content.url }}',
                          response: {{ content.get_html_from_json }},

                      {% elif content.Meta.verbose_name|lower == 'facebook image posts' %}
                          user: '{{ content.user }}',

                      {% elif content.Meta.verbose_name|lower == 'news panel' %}
                          ticker: {% ticker_combined request "main" feincms_page 1 %},
                      {% elif content.Meta.verbose_name|lower == 'weather panel' %}
                          location: '{{ content.location }}',
                      {% endif %}
                    },

                    duration: {{ content.duration }}
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ],
            announcements: [
              {% for content in feincms_page.content.announcements %}
              {
                ordering: {{ content.ordering }},
                priority: {{ content.priority }},
                morning: {{ content.morning|lower }},
                noon: {{ content.noon|lower }},
                afternoon: {{ content.afternoon|lower }},
                evening: {{ content.evening|lower }},
                night: {{ content.night|lower }},
                data: {
                  announcement: '{{ content.announcement }}'
                },
                duration: {{ content.duration }}
              }{% if not forloop.last %},{% endif %}
              {% endfor %}
            ]
        }
    </script>
</body>
</html>
