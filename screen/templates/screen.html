{% load feincms_tags ticker weather jsonify markdown_deux_tags %}
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="NOFOLLOW, NOINDEX" />

    <link rel="stylesheet" href="{{ STATIC_URL }}screen/css/lib/boilerplate.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}screen/fonts/akkurat.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}screen/fonts/bodoni.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}screen/css/lib/weather-icons.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}screen/css/dist/global.css" />

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

    <script type="text/javascript" src="{{ STATIC_URL }}screen/lib/coolclock/coolclock.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}screen/lib/coolclock/moreskins.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}screen/lib/skycons/skycons.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}screen/js/dist/main.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}screen/js/global.js"></script>

    <title>YouthHostel.ch Info Screen</title>
</head>
<body>
  <div id="container" class="flex flex-column cover-parent">
    <header class="flex space-around head">
        <div id="weather">
          <canvas id="weather-icon"></canvas>
          <span data-hook='weather-temperature'>??</span>
        </div>

        <div id="announcements">
            <div>Das ganze Jugi Team wünscht Ihnen einen guten Appetit!</div>
        </div>

        <canvas id="clock" class="CoolClock:chunkySwiss:30"></canvas>
    </header>

    <div data-hook='panel-hook'></div>
  </div>

    <script type="text/template" id="text-template">
      <div>
        <%= textWrapped %>
      </div>
    </script>

    <script type="text/template" id="media-meta">
      <div class="image-meta">
        <div class="caption"><span><b><%- caption %></b></span></div>
        <div class="description"><span><%- description %></span></div>
        <div class="copyright"><span><%- copyright %></span></div>
      </div>
    </script>

    <script type="text/template" id="media-template-cover">
      <%= meta %>
    </script>

    <script type="text/template" id="media-template-contain">
      <div class="cover-parent flex flex-column">
        <div class="flex-grow bg-contain" style="background-image: url(<%- url %>)"></div>

        <%= meta %>
      </div>
    </script>

    <script>
        window.ScreenData = {
            location: "{{ feincms_page.location }}",
            main: [
                {% for content in feincms_page.content.main %}
                {
                    type: '{{ content.Meta.verbose_name|lower }}',
                    ordering: {{ content.ordering }},
                    priority: {{ content.priority }},
                    morning: {{ content.morning|lower }},
                    noon: {{ content.noon|lower }},
                    afternoon: {{ content.afternoon|lower }},
                    evening: {{ content.evening|lower }},
                    night: {{ content.night|lower }},

                    data: {
                      {% if content.Meta.verbose_name|lower == 'text' %}
                          text: '{{ content.text|markdown|escapejs }}',
                          size: '{{ content.size }}',

                      {% elif content.Meta.verbose_name|lower == 'mediendatei' %}

                          type: '{{ content.mediafile.type }}',
                          url: '{{ content.mediafile.get_absolute_url }}',
                          cover: {{ content.mediafile.cover|lower }},
                          caption: '{{ content.mediafile.translation.caption }}',
                          description: '{{ content.mediafile.translation.description }}',
                          copyright: '{{ content.mediafile.copyright }}'


                      {% elif content.Meta.verbose_name|lower == 'simple image gallery' %}
                          mediafiles: [
                              {% for m in content.category.mediafile_set.all %}
                              {
                                  url: '{{ m.get_absolute_url }}',
                                  cover: {{ m.cover|lower }},
                                  caption: '{{ m.translation.caption }}',
                                  copyright: '{{ m.copyright }}',
                                  description: '{{ m.translation.description }}'
                              }{% if not forloop.last %},{% endif %}
                              {% endfor %}
                          ],

                      {% elif content.Meta.verbose_name|lower == 'externer inhalt' %}
                          type: '{{ content.type }}',
                          response: {{ content.get_html_from_json }},

                      {% elif content.Meta.verbose_name|lower == 'facebook image posts' %}
                          user: '{{ content.user }}',

                      {% elif content.Meta.verbose_name|lower == 'news panel' %}
                          ticker: {% ticker_combined request "main" feincms_page 1 %},
                      {% endif %}
                    },

                    duration: {{ content.duration }}
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]
        }
    </script>
</body>
</html>
